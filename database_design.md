# تصميم قاعدة بيانات موقع الأخبار

## جداول قاعدة البيانات

### 1. جدول المستخدمين (users)
- `id`: معرف فريد (مفتاح أساسي)
- `username`: اسم المستخدم (فريد)
- `email`: البريد الإلكتروني (فريد)
- `password_hash`: تجزئة كلمة المرور
- `role`: دور المستخدم (مسؤول، محرر، مستخدم عادي)
- `created_at`: تاريخ إنشاء الحساب
- `last_login`: آخر تسجيل دخول
- `profile_image`: مسار صورة الملف الشخصي
- `is_active`: حالة الحساب (نشط/غير نشط)

### 2. جدول الأقسام (categories)
- `id`: معرف فريد (مفتاح أساسي)
- `name`: اسم القسم
- `slug`: اختصار للاستخدام في الروابط
- `description`: وصف القسم
- `icon`: أيقونة القسم
- `order`: ترتيب العرض

### 3. جدول المقالات (articles)
- `id`: معرف فريد (مفتاح أساسي)
- `title`: عنوان المقال
- `slug`: اختصار للاستخدام في الروابط
- `content`: محتوى المقال
- `summary`: ملخص المقال
- `featured_image`: مسار الصورة الرئيسية
- `author_id`: معرف الكاتب (مفتاح خارجي يرتبط بجدول المستخدمين)
- `category_id`: معرف القسم (مفتاح خارجي يرتبط بجدول الأقسام)
- `published_at`: تاريخ النشر
- `updated_at`: تاريخ آخر تحديث
- `status`: حالة المقال (مسودة، منشور، مؤرشف)
- `is_featured`: هل المقال مميز
- `is_breaking`: هل المقال خبر عاجل
- `views_count`: عدد المشاهدات

### 4. جدول الوسوم (tags)
- `id`: معرف فريد (مفتاح أساسي)
- `name`: اسم الوسم
- `slug`: اختصار للاستخدام في الروابط

### 5. جدول ربط المقالات بالوسوم (article_tags)
- `article_id`: معرف المقال (مفتاح خارجي)
- `tag_id`: معرف الوسم (مفتاح خارجي)

### 6. جدول التعليقات (comments)
- `id`: معرف فريد (مفتاح أساسي)
- `article_id`: معرف المقال (مفتاح خارجي)
- `user_id`: معرف المستخدم (مفتاح خارجي، يمكن أن يكون فارغاً للتعليقات المجهولة)
- `parent_id`: معرف التعليق الأب (للردود على التعليقات)
- `content`: محتوى التعليق
- `author_name`: اسم الكاتب (للتعليقات المجهولة)
- `author_email`: بريد الكاتب (للتعليقات المجهولة)
- `created_at`: تاريخ الإنشاء
- `status`: حالة التعليق (معلق، موافق عليه، مرفوض)
- `is_pinned`: هل التعليق مثبت

### 7. جدول الوسائط (media)
- `id`: معرف فريد (مفتاح أساسي)
- `article_id`: معرف المقال (مفتاح خارجي)
- `type`: نوع الوسائط (صورة، فيديو، ملف صوتي)
- `url`: مسار الملف
- `title`: عنوان الوسائط
- `description`: وصف الوسائط
- `uploaded_at`: تاريخ الرفع

### 8. جدول إحصائيات المقالات (article_stats)
- `article_id`: معرف المقال (مفتاح خارجي)
- `views`: عدد المشاهدات
- `shares`: عدد المشاركات
- `likes`: عدد الإعجابات
- `comments_count`: عدد التعليقات
- `last_updated`: تاريخ آخر تحديث للإحصائيات

### 9. جدول النشرة البريدية (newsletter_subscribers)
- `id`: معرف فريد (مفتاح أساسي)
- `email`: البريد الإلكتروني (فريد)
- `name`: اسم المشترك
- `subscribed_at`: تاريخ الاشتراك
- `is_active`: حالة الاشتراك
- `categories`: الأقسام المشترك فيها (مخزنة كسلسلة JSON)

## العلاقات بين الجداول

1. **المستخدمين والمقالات**: علاقة واحد إلى متعدد (كاتب واحد لعدة مقالات)
2. **الأقسام والمقالات**: علاقة واحد إلى متعدد (قسم واحد لعدة مقالات)
3. **المقالات والوسوم**: علاقة متعدد إلى متعدد (من خلال جدول article_tags)
4. **المقالات والتعليقات**: علاقة واحد إلى متعدد (مقال واحد لعدة تعليقات)
5. **التعليقات والتعليقات**: علاقة ذاتية لدعم التعليقات المتداخلة
6. **المقالات والوسائط**: علاقة واحد إلى متعدد (مقال واحد لعدة وسائط)
7. **المقالات وإحصائياتها**: علاقة واحد إلى واحد

## مخطط قاعدة البيانات

```
users 1 --- * articles
categories 1 --- * articles
articles * --- * tags (via article_tags)
articles 1 --- * comments
comments 1 --- * comments (self-referential)
articles 1 --- * media
articles 1 --- 1 article_stats
```

## ملاحظات تنفيذية

- استخدام الفهارس (Indexes) على الأعمدة المستخدمة بكثرة في عمليات البحث مثل `slug` و`published_at`
- تنفيذ قيود المفاتيح الخارجية مع خيار CASCADE للحذف والتحديث حيث يكون مناسباً
- استخدام الحقول المؤرشفة (Timestamp) لتتبع تواريخ الإنشاء والتحديث
- تخزين كلمات المرور باستخدام خوارزميات تجزئة آمنة مثل bcrypt
- استخدام الترميز UTF-8 لدعم اللغة العربية بشكل كامل
